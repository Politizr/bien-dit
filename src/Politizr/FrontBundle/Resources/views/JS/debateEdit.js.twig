<script>
    // **************************** //
    //      Initialisation editeur
    // **************************** //
    var summaryEditor = new MediumEditor('.summary-editable', {
        // buttonLabels: 'fontawesome',
        anchorButtonClass: 'mdm-btn',
    });
    var descriptionEditor = new MediumEditor('.description-editable', {
        // buttonLabels: 'fontawesome'
        anchorButtonClass: 'mdm-btn',
    });
    var moreInfoEditor = new MediumEditor('.moreInfo-editable', {
        // buttonLabels: 'fontawesome'
        anchorButtonClass: 'mdm-btn',
    });


    // **************************** //
    //      Initialisation
    // **************************** //
    $(document).ready(function () {
    });

    // **************************** //
    //      Fonctions simples
    // **************************** //

    // **************************** //
    //      POST
    // **************************** //

    // Update debate
    $('body').on('submit', '#form-debate-update', function(e){
        console.log('*** click submit');

        e.preventDefault();

        var summary = summaryEditor.serialize();
        var description = descriptionEditor.serialize();
        var moreInfo = moreInfoEditor.serialize();

        console.log(summary['element-0']['value']);
        console.log(description['element-0']['value']);
        console.log(moreInfo['element-0']['value']);

        $('#debate_summary').val(summary['element-0']['value']);
        $('#debate_description').val(description['element-0']['value']);
        $('#debate_more_info').val(moreInfo['element-0']['value']);
     
        $.ajax({
            type: 'POST',
            dataType: 'json',
            url : "{{ path('DebateUpdate') }}",
            data: $("#form-debate-update").serialize(),
            dataType: 'json',
            {% include 'PolitizrFrontBundle:JS:ajaxError.js.twig' %}
            success: function(data) {
                $('#ajax-loader').hide();
                if (data['error']) {
                    $('.alert-danger-msg').html(data['error']);
                    $('.alert.alert-danger').show();
                } else {
                    $('.alert-success-msg').html('Objet bien enregistré!');
                    $('.alert.alert-success').show();
                }
            }
        });
        return false;
    });

    // Update debate
    $('body').on('click', "a[action='debate-publish']", function(e){
        console.log('*** click publish');
        
        bootbox.confirm('Une fois publié, vous ne pourrez plus modifier le débat. Êtes-vous sûr de vouloir continuer?', function(result) {
            if (result) {
                $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    url : "{{ path('DebatePublish') }}",
                    data: { id: $('#debate_id').val() },
                    dataType: 'json',
                    {% include 'PolitizrFrontBundle:JS:ajaxError.js.twig' %}
                    success: function(data) {
                        $('#ajax-loader').hide();
                        if (data['error']) {
                            $('.alert-danger-msg').html(data['error']);
                            $('.alert.alert-danger').show();
                        } else {
                            // redirection
                            window.location = data['redirectUrl'];
                        }
                    }
                });
            }
        });
    });


    // Delete debate
    $('body').on('click', "a[action='debate-delete']", function(e){
        console.log('*** click delete');

        bootbox.confirm('Êtes-vous sûr de vouloir supprimer votre brouillon?', function(result) {
            if (result) {
                $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    url : "{{ path('DebateDelete') }}",
                    data: { id: $('#debate_id').val() },
                    dataType: 'json',
                    {% include 'PolitizrFrontBundle:JS:ajaxError.js.twig' %}
                    success: function(data) {
                        $('#ajax-loader').hide();
                        if (data['error']) {
                            $('.alert-danger-msg').html(data['error']);
                            $('.alert.alert-danger').show();
                        } else {
                            // redirection
                            window.location = data['redirectUrl'];
                        }
                    }
                });
            }
        });
    });



    // Delete list
    $('body').on('click', "a[action='debate-list']", function(e){
        console.log('*** click list');

        bootbox.confirm('Pensez à enregistrer votre travail avant de revenir à la liste. Voulez-vous revenir à la liste?', function(result) {
            if (result) {
                window.location = "{{ path('MyDraftsC') }}";
            }
        });
    });
</script>
