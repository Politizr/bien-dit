<script>
    // Publication debat
    $('body').on('click', "[action='debate-publish']", function(e){
        console.log('*** click publish');
        
        bootbox.confirm('Une fois publié, vous ne pourrez plus modifier votre débat. Voulez-vous publier votre débat?', function(result) {
            if (result) {
                $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    url : "{{ path('DebatePublish') }}",
                    data: { 'id': $("[action='debate-publish']").attr('object-id'), 'url': $("[action='debate-publish']").attr('url') },
                    dataType: 'json',
                    {% include 'PolitizrFrontBundle:JS:ajaxError.js.twig' %}
                    success: function(data) {
                        if (data['error']) {
                            $('#ajaxGlobalLoader').hide();
                            $('#infoBoxHolder.boxError.notifBoxText').html(data['error']);
                            $('#infoBoxHolder.boxError').show();
                        } else {
                            // redirection
                            window.location = data['redirectUrl'];
                        }
                    }
                });
            }
        });
    });


    // Suppression debat
    $('body').on('click', "[action='debate-delete']", function(e){
        console.log('*** click delete');

        bootbox.confirm('Êtes-vous sûr de vouloir supprimer votre brouillon?', function(result) {
            if (result) {
                $.ajax({
                    type: 'POST',
                    dataType: 'json',
                    url : "{{ path('DebateDelete') }}",
                    data: { 'id': $('#debate_id').val(), 'url': $("[action='debate-delete']").attr('url') },
                    dataType: 'json',
                    {% include 'PolitizrFrontBundle:JS:ajaxError.js.twig' %}
                    success: function(data) {
                        if (data['error']) {
                            $('#ajaxGlobalLoader').hide();
                            $('#infoBoxHolder.boxError.notifBoxText').html(data['error']);
                            $('#infoBoxHolder.boxError').show();
                        } else {
                            // redirection
                            window.location = data['redirectUrl'];
                        }
                    }
                });
            }
        });
    });
</script>