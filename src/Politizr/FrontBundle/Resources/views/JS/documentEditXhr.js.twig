<script>
    // **************************** //
    //      Auto save silencieuse
    //      TODO: à affiner
//    // **************************** //
//
//    // MAJ des tags
//    $(".auto_submit_form").change(function() {
//        $('[action="debate-save"]').trigger('click', 'silence');
//    });
//
//    // Saisie de texte sur les éditeurs medium
//    // http://stackoverflow.com/questions/9966394/can-i-delay-the-keyup-event-for-jquery
//    var autosave = $('.summary-editable, .description-editable').on('keyup', delayRequest);
//    function dataRequest() {
//        // $('[action="debate-save"]').click();
//        $('[action="debate-save"]').trigger('click', 'silence');
//    }
//    function delayRequest(ev) {
//        if(delayRequest.timeout) {
//            clearTimeout(delayRequest.timeout);
//        }
//    
//        var target = this;
//    
//        delayRequest.timeout = setTimeout(function() {
//            dataRequest.call(target, ev);
//        }, 2000); // 2s
//    }
//
//    // Mise en forme sur les éditeurs medium
//    $('.summary-editable, .description-editable').on('mouseup', function() {
//        $('[action="debate-save"]').trigger('click', 'silence');
//    });
//
//

    // Save debate
    $("body").on("click", "[action='debateSave']", function(e, mode) {
        console.log('*** click debate save');
        console.log(mode);

        var summary = summaryEditor.serialize();
        var description = descriptionEditor.serialize();

        console.log(summary['element-0']['value']);
        console.log(description['element-0']['value']);

        $('#debate_summary').val(summary['element-0']['value']);
        $('#debate_description').val(description['element-0']['value']);
     
        if (mode === 'silence') {
            // sauvegarde silencieuse
            $.ajax({type: 'POST', url : "{{ path('DebateUpdate') }}", data: $("#formDebateUpdate").serialize() });
        } else {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url : "{{ path('DebateUpdate') }}",
                data: $("#formDebateUpdate").serialize(),
                {% include 'PolitizrFrontBundle:JS:ajaxError.js.twig' %}
                success: function(data) {
                    $('#ajaxGlobalLoader').hide();
                    if (data['error']) {
                        $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                        $('#infoBoxHolder .boxError').show();
                    } else {
                        $('#infoBoxHolder .boxSuccess .notifBoxText').html('Document bien enregistré');
                        $('#infoBoxHolder .boxSuccess').show();
                    }
                }
            });
        }

        return false;
    });

    // Save reaction
    $("body").on("click", "[action='reactionSave']", function(e, mode) {
        console.log('*** click reaction save');
        console.log(mode);

        var summary = summaryEditor.serialize();
        var description = descriptionEditor.serialize();

        console.log(summary['element-0']['value']);
        console.log(description['element-0']['value']);

        $('#reaction_summary').val(summary['element-0']['value']);
        $('#reaction_description').val(description['element-0']['value']);
     
        if (mode === 'silence') {
            // sauvegarde silencieuse
            $.ajax({type: 'POST', url : "{{ path('ReactionUpdate') }}", data: $("#formReactionUpdate").serialize() });
        } else {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url : "{{ path('ReactionUpdate') }}",
                data: $("#formReactionUpdate").serialize(),
                {% include 'PolitizrFrontBundle:JS:ajaxError.js.twig' %}
                success: function(data) {
                    $('#ajaxGlobalLoader').hide();
                    if (data['error']) {
                        $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                        $('#infoBoxHolder .boxError').show();
                    } else {
                        $('#infoBoxHolder .boxSuccess .notifBoxText').html('Document bien enregistré');
                        $('#infoBoxHolder .boxSuccess').show();
                    }
                }
            });
        }

        return false;
    });

    // Publish debate
    $('body').on('click', "[action='debatePublish']", function(e){
        console.log('*** click publish debate');
        
        if (confirm('Une fois publié, vous ne pourrez plus modifier votre débat. Voulez-vous publier votre débat?')) {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url : "{{ path('DebatePublish') }}",
                data: { 'id': $(this).attr('subjectId'), 'url': $(this).attr('url') },
                dataType: 'json',
                {% include 'PolitizrFrontBundle:JS:ajaxError.js.twig' %}
                success: function(data) {
                    if (data['error']) {
                        $('#ajaxGlobalLoader').hide();
                        $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                        $('#infoBoxHolder .boxError').show();
                    } else {
                        // redirection
                        window.location = data['redirectUrl'];
                    }
                }
            });
        }
    });

    // Publish reaction
    $('body').on('click', "[action='reactionPublish']", function(e){
        console.log('*** click publish reaction');
        
        if (confirm('Une fois publié, vous ne pourrez plus modifier votre réaction. Voulez-vous publier votre réaction?')) {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url : "{{ path('ReactionPublish') }}",
                data: { 'id': $(this).attr('subjectId'), 'url': $(this).attr('url') },
                dataType: 'json',
                {% include 'PolitizrFrontBundle:JS:ajaxError.js.twig' %}
                success: function(data) {
                    if (data['error']) {
                        $('#ajaxGlobalLoader').hide();
                        $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                        $('#infoBoxHolder .boxError').show();
                    } else {
                        // redirection
                        window.location = data['redirectUrl'];
                    }
                }
            });
        }
    });

    // Delete debate
    $('body').on('click', "[action='debateDelete']", function(e){
        console.log('*** click delete debate');

        if (confirm('Êtes-vous sûr de vouloir supprimer votre brouillon?')) {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url : "{{ path('DebateDelete') }}",
                data: { 'id': $('#debate_id').val(), 'url': $(this).attr('url') },
                dataType: 'json',
                {% include 'PolitizrFrontBundle:JS:ajaxError.js.twig' %}
                success: function(data) {
                    if (data['error']) {
                        $('#ajaxGlobalLoader').hide();
                        $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                        $('#infoBoxHolder .boxError').show();
                    } else {
                        // redirection
                        window.location = data['redirectUrl'];
                    }
                }
            });
        }
    });

    // Delete reaction
    $('body').on('click', "[action='reactionDelete']", function(e){
        console.log('*** click delete reaction');

        if (confirm('Êtes-vous sûr de vouloir supprimer votre brouillon?')) {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url : "{{ path('ReactionDelete') }}",
                data: { 'id': $('#reaction_id').val(), 'url': $(this).attr('url') },
                dataType: 'json',
                {% include 'PolitizrFrontBundle:JS:ajaxError.js.twig' %}
                success: function(data) {
                    if (data['error']) {
                        $('#ajaxGlobalLoader').hide();
                        $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                        $('#infoBoxHolder .boxError').show();
                    } else {
                        // redirection
                        window.location = data['redirectUrl'];
                    }
                }
            });
        }
    });

</script>