<script>
    // modal ranking
    $("body").on("click", "[action='modalRanking']", function() {
        console.log('*** modalRanking');
        $('#modalBoxContent').removeClass().addClass('ranking');
        modalLoading();
        loadPaginatedList('_ranking.html.twig', 'true');
    });

    // modal suggestions
    $("body").on("click", "[action='modalSuggestions']", function() {
        console.log('*** modalSuggestions');
        $('#modalBoxContent').removeClass().addClass('suggestions');
        modalLoading();
        loadPaginatedList('_suggestions.html.twig', 'false');
    });

    // modal tag
    $("body").on("click", "[action='modalTagged']", function() {
        console.log('*** modalTagged');
        $('#modalBoxContent').removeClass().addClass('listByTag');
        modalLoading();

        loadPaginatedList('_tagged.html.twig', 'true', $(this).attr('model'), $(this).attr('slug'));
    });

    // modal organisation
    $("body").on("click", "[action='modalOrganization']", function() {
        console.log('*** modalTagged');
        $('#modalBoxContent').removeClass().addClass('organizationSheet');
        modalLoading();

        loadPaginatedList('_organization.html.twig', 'true', $(this).attr('model'), $(this).attr('slug'));
    });

    // modal subscriptions
    $("body").on("click", "[action='modalSubscriptions']", function() {
        console.log('*** modalTagged');
        $('#modalBoxContent').removeClass().addClass('subscriptions');
        modalLoading();

        loadPaginatedList('_subscriptions.html.twig', 'true');
    });

    // code générique de chargement d'une modal
    function modalLoading() {
        $('#modalBox').fadeIn('fast');
        $('body').addClass('noscroll');
        $('html, body').animate({
            scrollTop: $("body").offset().top
        }, 0);
        $(".modalRightCol").addClass('activeMobileModal');
    };

    /**
     * Chargement d'une liste paginée
     * @todo rendre générique le chargement des contenu de modal de liste
     *
     * @param string twigTemplate
     * @param string withFilters  true | false
     */
    function loadPaginatedList(twigTemplate, withFilters, model, slug) {
        console.log('*** loadPaginatedList');
        console.log(twigTemplate);

        if (typeof twigTemplate === "undefined") {
            return false;
        }
        withFilters = (typeof withFilters === "undefined") ? 'true' : withFilters;

        $.ajax({
            type: 'POST',
            url: "{{ path('ModalPaginatedList') }}",
            data: { 'twigTemplate': twigTemplate, 'model': model, 'slug': slug },
            dataType: 'json',
            {% include 'PolitizrFrontBundle:JS:ajaxError.js.twig' %}
            success: function(data) {
                if (data['error']) {
                    $('#infoBoxHolder.boxError.notifBoxText').html(data['error']);
                    $('#infoBoxHolder.boxError').show();
                } else {
                    $('#modalBoxContent').html(data['html']);
                    initListing('debate', withFilters);
                }
                $('#ajaxGlobalLoader').hide();
            }
        });
    }

</script>

