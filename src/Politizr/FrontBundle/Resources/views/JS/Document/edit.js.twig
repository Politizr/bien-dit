<script>
    // **************************** //
    //      Auto save silencieuse
    //      TODO: à affiner
//    // **************************** //
//
//    // MAJ des tags
//    $(".auto_submit_form").change(function() {
//        $('[action="debate-save"]').trigger('click', 'silence');
//    });
//
//    // Saisie de texte sur les éditeurs medium
//    // http://stackoverflow.com/questions/9966394/can-i-delay-the-keyup-event-for-jquery
//    var autosave = $('.summary-editable, .description-editable').on('keyup', delayRequest);
//    function dataRequest() {
//        // $('[action="debate-save"]').click();
//        $('[action="debate-save"]').trigger('click', 'silence');
//    }
//    function delayRequest(ev) {
//        if(delayRequest.timeout) {
//            clearTimeout(delayRequest.timeout);
//        }
//    
//        var target = this;
//    
//        delayRequest.timeout = setTimeout(function() {
//            dataRequest.call(target, ev);
//        }, 2000); // 2s
//    }
//
//    // Mise en forme sur les éditeurs medium
//    $('.summary-editable, .description-editable').on('mouseup', function() {
//        $('[action="debate-save"]').trigger('click', 'silence');
//    });
//
//
    // compared mode
    $("body").on("click", "[action='activeComparedEdition']", function() {
        $('#swithEditionIndependentEdition').hide();
        $('#swithEditionComparedEdition').show();
        $('#postText').animate({width: "500px"}, 300);
        $('#postText .paragraph').animate({width: "340px"}, 300);
        $('#originalText').fadeIn(800);
    });
    
    $("body").on("click", "[action='activeIndenpendentEdition']", function() {
        $('#swithEditionIndependentEdition').show();
        $('#swithEditionComparedEdition').hide();
        $('#originalText').fadeOut();
        $('#postText').animate({width: "700px"}, 300);
        $('#postText .paragraph').animate({width: "540px"}, 300);
    });
    
    // edit title : auto resize text area
    $('.postSummaryFooter, #postText').on( 'change keyup keydown paste cut', 'textarea', function (){
        $(this).height(0).height(this.scrollHeight);                    
    }).find( 'textarea' ).change();
    
    // Save debate
    $("body").on("click", "[action='debateSave']", function(e, mode) {
        console.log('*** click debate save');
        console.log(mode);

        var xhrPath = "{% include 'PolitizrFrontBundle:Navigation\\Xhr:_xhrPath.html.twig' with {
            'xhrRoute': 'ROUTE_DEBATE_UPDATE',
            'xhrService': 'document',
            'xhrMethod': 'debateUpdate',
            'xhrType': 'RETURN_BOOLEAN',
            } only %}";
        var description = descriptionEditor.serialize();
        console.log(description['element-0']['value']);

        $('#debate_description').val(description['element-0']['value']);

        if (mode === 'silence') {
            // sauvegarde silencieuse
            $.ajax({type: 'POST', url: xhrPath, data: $("#formDebateUpdate").serialize() });
        } else {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url : path,
                data: $("#formDebateUpdate").serialize(),
                {% include 'PolitizrFrontBundle:JS:_ajaxError.js.twig' %}
                success: function(data) {
                    $('#ajaxGlobalLoader').hide();
                    if (data['error']) {
                        $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                        $('#infoBoxHolder .boxError').show();
                    } else {
                        $('#infoBoxHolder .boxSuccess .notifBoxText').html('Document bien enregistré');
                        $('#infoBoxHolder .boxSuccess').show();
                    }
                }
            });
        }

        return false;
    });

    // Save reaction
    $("body").on("click", "[action='reactionSave']", function(e, mode) {
        console.log('*** click reaction save');
        console.log(mode);

        var xhrPath = "{% include 'PolitizrFrontBundle:Navigation\\Xhr:_xhrPath.html.twig' with {
            'xhrRoute': 'ROUTE_REACTION_UPDATE',
            'xhrService': 'document',
            'xhrMethod': 'reactionUpdate',
            'xhrType': 'RETURN_BOOLEAN',
            } only %}";
        var description = descriptionEditor.serialize();
        console.log(description['element-0']['value']);

        $('#reaction_description').val(description['element-0']['value']);
     
        if (mode === 'silence') {
            // sauvegarde silencieuse
            $.ajax({type: 'POST', url: path, data: $("#formReactionUpdate").serialize() });
        } else {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url : xhrPath,
                data: $("#formReactionUpdate").serialize(),
                {% include 'PolitizrFrontBundle:JS:_ajaxError.js.twig' %}
                success: function(data) {
                    $('#ajaxGlobalLoader').hide();
                    if (data['error']) {
                        $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                        $('#infoBoxHolder .boxError').show();
                    } else {
                        $('#infoBoxHolder .boxSuccess .notifBoxText').html('Document bien enregistré');
                        $('#infoBoxHolder .boxSuccess').show();
                    }
                }
            });
        }

        return false;
    });

    // Publish debate
    $('body').on('click', "[action='debatePublish']", function(e){
        console.log('*** click publish debate');

        var xhrPath = "{% include 'PolitizrFrontBundle:Navigation\\Xhr:_xhrPath.html.twig' with {
            'xhrRoute': 'ROUTE_DEBATE_PUBLISH',
            'xhrService': 'document',
            'xhrMethod': 'debatePublish',
            'xhrType': 'RETURN_URL',
            } only %}";

        if (confirm('Une fois publié, vous ne pourrez plus modifier votre débat. Voulez-vous publier votre débat?')) {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url : xhrPath,
                data: { 'id': $(this).attr('subjectId') },
                dataType: 'json',
                {% include 'PolitizrFrontBundle:JS:_ajaxError.js.twig' %}
                success: function(data) {
                    if (data['error']) {
                        $('#ajaxGlobalLoader').hide();
                        $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                        $('#infoBoxHolder .boxError').show();
                    } else {
                        // redirection
                        window.location = data['redirectUrl'];
                    }
                }
            });
        }
    });

    // Publish reaction
    $('body').on('click', "[action='reactionPublish']", function(e){
        console.log('*** click publish reaction');

        var xhrPath = "{% include 'PolitizrFrontBundle:Navigation\\Xhr:_xhrPath.html.twig' with {
            'xhrRoute': 'ROUTE_REACTION_PUBLISH',
            'xhrService': 'document',
            'xhrMethod': 'reactionPublish',
            'xhrType': 'RETURN_URL',
            } only %}";
        
        if (confirm('Une fois publié, vous ne pourrez plus modifier votre réaction. Voulez-vous publier votre réaction?')) {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url : xhrPath,
                data: { 'id': $(this).attr('subjectId') },
                dataType: 'json',
                {% include 'PolitizrFrontBundle:JS:_ajaxError.js.twig' %}
                success: function(data) {
                    if (data['error']) {
                        $('#ajaxGlobalLoader').hide();
                        $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                        $('#infoBoxHolder .boxError').show();
                    } else {
                        // redirection
                        window.location = data['redirectUrl'];
                    }
                }
            });
        }
    });

    // Delete debate
    $('body').on('click', "[action='debateDelete']", function(e){
        console.log('*** click delete debate');

        var xhrPath = "{% include 'PolitizrFrontBundle:Navigation\\Xhr:_xhrPath.html.twig' with {
            'xhrRoute': 'ROUTE_DEBATE_DELETE',
            'xhrService': 'document',
            'xhrMethod': 'debateDelete',
            'xhrType': 'RETURN_URL',
            } only %}";

        if (confirm('Êtes-vous sûr de vouloir supprimer votre brouillon?')) {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url : xhrPath,
                data: { 'id': $('#debate_id').val() },
                dataType: 'json',
                {% include 'PolitizrFrontBundle:JS:_ajaxError.js.twig' %}
                success: function(data) {
                    if (data['error']) {
                        $('#ajaxGlobalLoader').hide();
                        $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                        $('#infoBoxHolder .boxError').show();
                    } else {
                        // redirection
                        window.location = data['redirectUrl'];
                    }
                }
            });
        }
    });

    // Delete reaction
    $('body').on('click', "[action='reactionDelete']", function(e){
        console.log('*** click delete reaction');

        var xhrPath = "{% include 'PolitizrFrontBundle:Navigation\\Xhr:_xhrPath.html.twig' with {
            'xhrRoute': 'ROUTE_REACTION_DELETE',
            'xhrService': 'document',
            'xhrMethod': 'reactionDelete',
            'xhrType': 'RETURN_URL',
            } only %}";

        if (confirm('Êtes-vous sûr de vouloir supprimer votre brouillon?')) {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url : xhrPath,
                data: { 'id': $('#reaction_id').val() },
                dataType: 'json',
                {% include 'PolitizrFrontBundle:JS:_ajaxError.js.twig' %}
                success: function(data) {
                    if (data['error']) {
                        $('#ajaxGlobalLoader').hide();
                        $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                        $('#infoBoxHolder .boxError').show();
                    } else {
                        // redirection
                        window.location = data['redirectUrl'];
                    }
                }
            });
        }
    });

</script>