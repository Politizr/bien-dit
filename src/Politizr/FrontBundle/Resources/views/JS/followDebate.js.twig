<script>
    // **************************** //
    //      AJAX
    // **************************** //

    // suivre / ne plus suivre
    $("body").on("click", "[action='followDebate']", function(e) {
        console.log('*** click followDebate');
        
        var context = $(this).closest('.listPost');
        $.ajax({
            type: 'POST',
            url: "{{ path('FollowDebate') }}",
            context: context,
            data: { 'objectId': $(this).attr('object-id'), 'way': $(this).attr('way') },
            dataType: 'json',
            {% include 'PolitizrFrontBundle:JS:ajaxError.js.twig' %}
            success: function(data) {
                $('#ajaxGlobalLoader').hide();
                if (data['error']) {
                    $('#infoBoxHolder.boxError.notifBoxText').html(data['error']);
                    $('#infoBoxHolder.boxError').show();
                } else {
                    // MAJ du bouton suivre / ne plus suivre
                    $(this).find('.subscribe').html(data['html']);

                    // @todo refactoring / à supprimer?
                    // Bloc followers existant à rafraichir?
                    if ($(this).find('#followers').length) {
                        $(this).find('#followers').html(data['followers']);
                        $(this).find("div[action='followers-c-list']").hide();
                        $(this).find("div[action='followers-q-list']").hide();           
                    }
                }
            }
        });

    });

</script>
