<script>
    // **************************** //
    //      Initialisation editeur
    // **************************** //
    var summaryEditor = new MediumEditor('.summary-editable', {
        // buttonLabels: 'fontawesome',
        anchorButtonClass: 'mdm-btn',
        placeholder: 'Saisissez ici le résumé de la réaction.',
    });
    var descriptionEditor = new MediumEditor('.description-editable', {
        // buttonLabels: 'fontawesome'
        anchorButtonClass: 'mdm-btn',
        placeholder: 'Saisissez ici le corps de la réaction.',
    });


    // **************************** //
    //      Suppression style Bootstrap sur input
    // **************************** //
    $(function () {
        $("body").find("#main input.form-control").attr("class", "h1");
    });

    // **************************** //
    //      Auto save silencieuse
    //      TODO: à affiner
    // **************************** //

    // MAJ des tags
    $(".auto_submit_form").change(function() {
        $('[action="reaction-save"]').trigger('click', 'silence');
    });

    // Saisie de texte sur les éditeurs medium
    // http://stackoverflow.com/questions/9966394/can-i-delay-the-keyup-event-for-jquery
    var autosave = $('.summary-editable, .description-editable').on('keyup', delayRequest);
    function dataRequest() {
        // $('[action="reaction-save"]').click();
        $('[action="reaction-save"]').trigger('click', 'silence');
    }
    function delayRequest(ev) {
        if(delayRequest.timeout) {
            clearTimeout(delayRequest.timeout);
        }
    
        var target = this;
    
        delayRequest.timeout = setTimeout(function() {
            dataRequest.call(target, ev);
        }, 2000); // 2s
    }

    // Mise en forme sur les éditeurs medium
    $('.summary-editable, .description-editable').on('mouseup', function() {
        $('[action="reaction-save"]').trigger('click', 'silence');
    });


    // **************************** //
    //      POST
    // **************************** //
    // Update reaction
    $("body").on("click", "[action='reaction-save']", function(e, mode) {
        console.log('*** click save');
        console.log(mode);

        var summary = summaryEditor.serialize();
        var description = descriptionEditor.serialize();

        console.log(summary['element-0']['value']);
        console.log(description['element-0']['value']);

        $('#reaction_summary').val(summary['element-0']['value']);
        $('#reaction_description').val(description['element-0']['value']);
     
        if (mode === 'silence') {
            // sauvegarde silencieuse
            $.ajax({type: 'POST', url : "{{ path('ReactionUpdate') }}", data: $("#form-reaction-update").serialize() });
        } else {
            $.ajax({
                type: 'POST',
                dataType: 'json',
                url : "{{ path('ReactionUpdate') }}",
                data: $("#form-reaction-update").serialize(),
                {% include 'PolitizrFrontBundle:JS:ajaxError.js.twig' %}
                success: function(data) {
                    $('#ajaxGlobalLoader').hide();
                    if (data['error']) {
                        $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                        $('#infoBoxHolder .boxError').show();
                    } else {
                        $('#infoBoxHolder .boxSuccess .notifBoxText').html('Objet bien enregistré!');
                        $('#infoBoxHolder .boxSuccess').show();
                    }
                }
            });
        }

        return false;
    });

    // Retour liste
    $('body').on('click', "[action='reaction-list']", function(e){
        window.location = $("[action='reaction-list']").attr('url');
    });


</script>
