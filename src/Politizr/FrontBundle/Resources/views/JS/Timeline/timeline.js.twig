<script>
    // on document ready
    $(function() {
        {% if (route == constant('Politizr\\Constant\\XhrConstants::ROUTE_TIMELINE_MINE')) %}
            timelineList();
        {% elseif (route == constant('Politizr\\Constant\\XhrConstants::ROUTE_TIMELINE_USER')) %}
            timelineUserList({{ userId }});
        {% endif %}
    });

    // Next page
    $("body").on("click", "[action='timelinePaginatedNext']", function(e) {
        timelineList(false, $(this).attr('offset'));
    });

    // Next page
    $("body").on("click", "[action='timelineUserPaginatedNext']", function(e) {
        timelineUserList($(this).attr('userId'), false, $(this).attr('offset'));
    });

    /**
     * Personal user's timeline
     *
     * @param boolean init
     * @param integer offset
     */
    function timelineList(init, offset) {
        console.log('*** timelineList');
        console.log(init);
        console.log(offset);

        init = (typeof init === "undefined") ? true : init;
        offset = (typeof offset === "undefined") ? 0 : offset;
        
        var xhrPath = "{% include 'PolitizrFrontBundle:Navigation\\Xhr:_xhrPath.html.twig' with {
            'xhrRoute': 'ROUTE_TIMELINE_MINE',
            'xhrService': 'user',
            'xhrMethod': 'timelinePaginated',
            'xhrType': 'RETURN_HTML',
            } only %}";

        $.ajax({
            type: 'POST',
            url: xhrPath,
            data: { 'offset': offset },
            dataType: 'json',
            {% include 'PolitizrFrontBundle:JS:_ajaxError.js.twig' %}
            success: function(data) {
                if (data['error']) {
                    $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                    $('#infoBoxHolder .boxError').show();
                } else {
                    $('#timelineScrollNav').remove();
                    if (init) {
                        $('#listContent').html(data['html']);
                    } else {
                        $('#listContent').append(data['html']);
                    }

                    // maj DOM onSuccess
                    stickyDate();
                    fullImgLiquid();
                }
                $('#ajaxGlobalLoader').hide();
            }
        });
    }

    /**
     * User's timeline
     *
     * @param integer userId
     * @param boolean init
     * @param integer offset
     */
    function timelineUserList(userId, init, offset) {
        console.log('*** timelineUserList');
        console.log(userId);
        console.log(init);
        console.log(offset);

        init = (typeof init === "undefined") ? true : init;
        offset = (typeof offset === "undefined") ? 0 : offset;
        
        var xhrPath = "{% include 'PolitizrFrontBundle:Navigation\\Xhr:_xhrPath.html.twig' with {
            'xhrRoute': 'ROUTE_TIMELINE_MINE',
            'xhrService': 'user',
            'xhrMethod': 'timelineUserPaginated',
            'xhrType': 'RETURN_HTML',
            } only %}";

        $.ajax({
            type: 'POST',
            url: xhrPath,
            data: { 'userId': userId, 'offset': offset },
            dataType: 'json',
            {% include 'PolitizrFrontBundle:JS:_ajaxError.js.twig' %}
            success: function(data) {
                if (data['error']) {
                    $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                    $('#infoBoxHolder .boxError').show();
                } else {
                    $('#timelineScrollNav').remove();
                    if (init) {
                        $('#listContent').html(data['html']);
                    } else {
                        $('#listContent').append(data['html']);
                    }

                    // maj DOM onSuccess
                    stickyDate();
                    fullImgLiquid();
                }
                $('#ajaxGlobalLoader').hide();
            }
        });
    }
</script>