<script>
    // modal ranking
    $("body").on("click", "[action='modalRanking']", function() {
        console.log('*** modalRanking');
        $('#modalBoxContent').removeClass().addClass('ranking');
        modalLoading();
        loadPaginatedList('_ranking.html.twig', 'true');
    });

    // modal suggestions
    $("body").on("click", "[action='modalSuggestions']", function() {
        console.log('*** modalSuggestions');
        $('#modalBoxContent').removeClass().addClass('suggestions');
        modalLoading();
        loadPaginatedList('_suggestions.html.twig', 'false');
    });

    // modal tag
    $("body").on("click", "[action='modalTagged']", function() {
        console.log('*** modalTagged');
        $('#modalBoxContent').removeClass().addClass('listByTag');
        modalLoading();

        loadPaginatedList('_tagged.html.twig', 'true', $(this).attr('model'), $(this).attr('slug'));
    });

    // modal organisation
    $("body").on("click", "[action='modalOrganization']", function() {
        console.log('*** modalOrganization');
        $('#modalBoxContent').removeClass().addClass('organizationSheet');
        modalLoading();

        loadPaginatedList('_organization.html.twig', 'true', $(this).attr('model'), $(this).attr('slug'));
    });

    // modal subscriptions
    $("body").on("click", "[action='modalSubscriptions']", function() {
        console.log('*** modalSubscriptions');
        $('#modalBoxContent').removeClass().addClass('subscriptions');
        modalLoading();

        loadPaginatedList('_subscriptions.html.twig', 'true');
    });

    // modal followers
    $("body").on("click", "[action='modalFollowers']", function() {
        console.log('*** modalFollowers');
        $('#modalBoxContent').removeClass().addClass('followers');
        modalLoading();

        loadPaginatedList('_followers.html.twig', 'true', $(this).attr('model'), $(this).attr('slug'));
    });


    // modal abuse
    $("body").on("click", "[action='modalAbuse']", function() {
        console.log('*** modalAbuse');
        $('#modalBoxContent').removeClass().addClass('formAbuse');
        modalLoading();

        var subjectId = $(this).attr('subjectId');
        var type = $(this).attr('type');

        console.log(subjectId);
        console.log(type);

        loadAbuseBox(subjectId, type);
    });


    // generic modal loading
    function modalLoading() {
        $('#modalBox').fadeIn('fast');
        $('body').addClass('noscroll');
        $('html, body').animate({
            scrollTop: $("body").offset().top
        }, 0);
        $(".modalRightCol").addClass('activeMobileModal');
    };

    /**
     * Load paginated list
     *
     * @param string twigTemplate
     * @param string withFilters  true | false
     */
    function loadPaginatedList(twigTemplate, withFilters, model, slug) {
        console.log('*** loadPaginatedList');
        console.log(twigTemplate);

        if (typeof twigTemplate === "undefined") {
            return false;
        }
        withFilters = (typeof withFilters === "undefined") ? 'true' : withFilters;

        var xhrPath = "{% include 'PolitizrFrontBundle:Navigation\\Xhr:_xhrPath.html.twig' with {
            'xhrRoute': 'ROUTE_MODAL_PAGINATED_LIST',
            'xhrService': 'modal',
            'xhrMethod': 'modalPaginatedList',
            'xhrType': 'RETURN_HTML',
            } only %}";

        $.ajax({
            type: 'POST',
            url: xhrPath,
            data: { 'twigTemplate': twigTemplate, 'model': model, 'slug': slug },
            dataType: 'json',
            {% include 'PolitizrFrontBundle:JS:_ajaxError.js.twig' %}
            success: function(data) {
                if (data['error']) {
                    $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                    $('#infoBoxHolder .boxError').show();
                } else {
                    $('#modalBoxContent').html(data['html']);
                    initListing('debate', withFilters);
                }
                $('#ajaxGlobalLoader').hide();
            }
        });
    }

    /**
     * Abuse box loading
     */
    function loadAbuseBox(subjectId, type) {
        console.log('*** loadAbuseBox');
        subjectId = (typeof subjectId === "undefined") ? null : subjectId;
        type = (typeof type === "undefined") ? null : type;

        if (subjectId == null ||Â type == null) {
            return false;
        }

        var xhrPath = "{% include 'PolitizrFrontBundle:Navigation\\Xhr:_xhrPath.html.twig' with {
            'xhrRoute': 'ROUTE_MONITORING_ABUSE',
            'xhrService': 'monitoring',
            'xhrMethod': 'abuse',
            'xhrType': 'RETURN_HTML',
            } only %}";

        $.ajax({
            type: 'POST',
            url: xhrPath,
            data: { 'subjectId': subjectId, 'type': type },
            dataType: 'json',
            {% include 'PolitizrFrontBundle:JS:_ajaxError.js.twig' %}
            success: function(data) {
                if (data['error']) {
                    $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                    $('#infoBoxHolder .boxError').show();
                } else {
                    $('#modalBoxContent').html(data['html']);
                }
                $('#ajaxGlobalLoader').hide();
            }
        });
    }

</script>

