<script>
    $(document).ready(function () {
        // Initialisation form ajax upload
        $("#formDocumentPhoto").ajaxForm(options);
    });

    // open upload modal
    $("body").on("click", "[action='modalUploadOpen']", function() {
        $('#modalUploadBox').show();
        $('#modalUpload').slideDown('fast');
        $('body').addClass('noscroll');
        $('html, body').animate({
            scrollTop: $("body").offset().top
        }, 0);
    });

    // close upload modal 
    $("body").on("click", "[action='modalUploadClose']", function() {
        $('body').removeClass('noscroll');
        $('#modalUploadBox').hide();
        $('#modalUpload').slideUp();
    });
    
    // image shadow on/off
    $("body").on("click", "[action='maskIllustrationShadow']", function() {
        $('.maskIllustrationShadow, #currentPhoto .illustrationShadow').hide();
        $('.showIllustrationShadow').show();
    });
    $("body").on("click", "[action='showIllustrationShadow']", function() {
        $('.showIllustrationShadow').hide();
        $('.maskIllustrationShadow, #currentPhoto .illustrationShadow').show();
    });


    // **************************** //
    //      LISTENERS
    // **************************** //
    // Clic bouton upload photo local
    $("body").on("click", "[action='fileSelect']", function() {
        console.log('click file select');
        $("#fileName").trigger('click');
        return false;
    });

    // Upload simple
    $("body").on("change", "#fileName", function() {
        console.log('change file name');
        $('#formDocumentPhoto').submit();
    });


    // **************************** //
    //      VARIABLES
    // **************************** //
    // Options Jquery Form JS > upload ajax
    var options = {
        // iframe: true,
        beforeSend: function() 
        {
            $('#ajaxGlobalLoader').show();
        },
        success: function() 
        {
            $('#ajaxGlobalLoader').hide();
        },
        complete: function(data) 
        {
            data = data.responseText;
            console.log('data.responseText = ' + data);

            // Gestion retour iframe IE
            data = data.replace('<PRE>', '');
            data = data.replace('</PRE>', '');
            data = data.replace('<pre>', '');
            data = data.replace('</pre>', '');
            console.log('data replace = ' + data);
            data = $.parseJSON( data );
            console.log('data parse JSON = ' + data);

            if (data['success']) {
                // update & imgLiquid uploaded photo
                $('#uploadedPhoto').html(data['html']);
                onSuccessImgLiquid();

                $('#debate_photo_info_file_name').val(data['fileName']);
            }
        },
        error: function(data)
        {
            $('#ajaxGlobalLoader').hide();
            $('#infoBoxHolder .boxError .notifBoxText').html('Erreur inconnue: merci de recharger la page.');
            $('#infoBoxHolder .boxError').show();
        }
    }; 



    // Suppression photo
    $('body').on('click', "[action='fileDelete']", function(e){
        console.log('*** click file delete');

        $('#uploadedPhoto').html('');
        $('#debate_photo_info_file_name').val(null);
    });

    // Save debate photo info
    $("body").on("click", "[action='debatePhotoInfoSave']", function(e) {
        console.log('*** click save photo info');

        var copyright = copyrightEditor.serialize();
        console.log(copyright['element-0']['value']);

        $('#debate_photo_info_copyright').val(copyright['element-0']['value']);
     
        // check visibility for "with_shadow" argument pour transmettre la valeur shadow associé à l'image
        if ($('.showIllustrationShadow').is(':visible')) {
            $('#debate_photo_info_with_shadow').val(0);
        } else {
            $('#debate_photo_info_with_shadow').val(1);
        }

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url : "{{ path('DebatePhotoInfoUpdate') }}",
            data: $("#formDebatePhotoInfoUpdate").serialize(),
            {% include 'PolitizrFrontBundle:JS:ajaxError.js.twig' %}
            success: function(data) {
                $('#ajaxGlobalLoader').hide();
                if (data['error']) {
                    $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                    $('#infoBoxHolder .boxError').show();
                } else {
                    // update copyright info
                    $('#copyright').html(data['copyright']);

                    // update & imgLiquid uploaded photo
                    console.log(data['imageHeader']);
                    $('#mainPhoto').html(data['imageHeader']);
                    $('#lPhoto').html(data['imageHeader']);
                    $('#rPhoto').html(data['imageHeader']);
                    onSuccessImgLiquid();

                    $("[action='modalUploadClose']").trigger('click');
                }
            }
        });
    });


</script>