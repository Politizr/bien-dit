<script>
    // on document ready
    $(function() {
        //Â Initialisation form ajax upload
        $("#form-user-back-photo").ajaxForm(optionsBack);
        $("#form-user-photo").ajaxForm(options);
    });

    // **************************** //
    //      LISTENERS
    // **************************** //
    // Clic bouton upload photo local
    $("body").on("click", "[action='back-file-select']", function() {
        $("[action='back-file-upload']").trigger('click');
        return false;
    });
    $("body").on("click", "[action='file-select']", function() {
        $("[action='file-upload']").trigger('click');
        return false;
    });


    // Upload simple
    $("body").on("change", "[action='back-file-upload']", function() {
        $('#form-user-back-photo').submit();
    });
    $("body").on("change", "[action='file-upload']", function() {
        $('#form-user-photo').submit();
    });


    // **************************** //
    //      VARIABLES
    // **************************** //
    // Options Jquery Form JS > upload ajax

    // photo back
    var optionsBack = {
        // iframe: true,
        beforeSend: function() 
        {
            $('#ajaxGlobalLoader').show();
        },
        success: function() 
        {
            $('#ajaxGlobalLoader').hide();
        },
        complete: function(data) 
        {
            data = data.responseText;
            console.log('data.responseText = ' + data);

            // Gestion retour iframe IE
            data = data.replace('<PRE>', '');
            data = data.replace('</PRE>', '');
            data = data.replace('<pre>', '');
            data = data.replace('</pre>', '');
            console.log('data replace = ' + data);
            data = $.parseJSON( data );
            console.log('data parse JSON = ' + data);

            if (!data['success']) {
                $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                $('#infoBoxHolder .boxError').show();
            } else {
                $('#header').css('background-image', 'url(/uploads/users/'+data['filename']+')');
            }
        },
        error: function(data)
        {
            $('#ajaxGlobalLoader').hide();
            $('#infoBoxHolder .boxError .notifBoxText').html('Erreur inconnue: merci de recharger la page.');
            $('#infoBoxHolder .boxError').show();
        }
    }; 

    // photo profil
    var options = {
        // iframe: true,
        beforeSend: function() 
        {
            $('#ajaxGlobalLoader').show();
        },
        success: function() 
        {
            $('#ajaxGlobalLoader').hide();
        },
        complete: function(data) 
        {
            data = data.responseText;
            console.log('data.responseText = ' + data);

            // Gestion retour iframe IE
            data = data.replace('<PRE>', '');
            data = data.replace('</PRE>', '');
            data = data.replace('<pre>', '');
            data = data.replace('</pre>', '');
            console.log('data replace = ' + data);
            data = $.parseJSON( data );
            console.log('data parse JSON = ' + data);

            if (!data['success']) {
                $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                $('#infoBoxHolder .boxError').show();
            } else {
                $('#current-photo').html('<img class="img-rounded" src="/uploads/users/'+data['filename']+'" />')
            }
        },
        error: function(data)
        {
            $('#ajaxGlobalLoader').hide();
            $('#infoBoxHolder .boxError .notifBoxText').html('Erreur inconnue: merci de recharger la page.');
            $('#infoBoxHolder .boxError').show();
        }
    }; 


    // Suppression photo
    $('body').on('click', '[action="back-file-delete"]', function(e){
        console.log('*** click back file delete');

        e.preventDefault();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url : "{{ path('UserBackPhotoDelete') }}",
            data: $("#form-user-back-photo").serialize(),
            dataType: 'json',
            {% include 'PolitizrFrontBundle:JS:_ajaxError.js.twig' %}
            success: function(data) {
                $('#ajaxGlobalLoader').hide();
                if (data['error']) {
                    $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                    $('#infoBoxHolder .boxError').show();
                } else {
                    $('#header').css('background-image', 'url(/bundles/politizrfront/images/default_user_back.jpg');
                }
            }
        });
    });

    // Suppression photo
    $('body').on('click', '[action="file-delete"]', function(e){
        console.log('*** click file delete');

        e.preventDefault();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url : "{{ path('UserPhotoDelete') }}",
            data: $("#form-user-photo").serialize(),
            dataType: 'json',
            {% include 'PolitizrFrontBundle:JS:_ajaxError.js.twig' %}
            success: function(data) {
                $('#ajaxGlobalLoader').hide();
                if (data['error']) {
                    $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                    $('#infoBoxHolder .boxError').show();
                } else {
                    $('#current-photo').html('<img  class="img-rounded" src="{{ asset("bundles/politizrfront/images/profil_default.png") }}">');
                }
            }
        });
    });
</script>