<script>
    // **************************** //
    //      Initialisation
    // **************************** //
    $(document).ready(function () {
        // Chargement du tableau des tags
        $.ajax({
            type: 'POST',
            url: "{{ path('GetPTags') }}",
            data: { 'pTTagTypeId': $('#selectGeoZone').attr('pTTagTypeId') },
            dataType: 'json',
            {% include 'PolitizrFrontBundle:Navigation:ajaxError.js.twig' %}
            success: function(data) {
                if (data['error']) {
                    $('#ajaxLoader').hide();
                    $('#boxErrorLogin').html(data['error']);
                    $('#boxErrorLogin').show();
                } else {
                    var availableTags = [];
                    $.each( data['pTags'], function( key, val ) {
                        var item = [];
                        item['label'] = val.title;
                        item['value'] = val.id;

                        availableTags.push(item);
                    });
                    // http://api.jqueryui.com/autocomplete/
                    $("#selectGeo").autocomplete({
                        source: availableTags,
                        select: function (event, ui) {
                            event.preventDefault();

                            $("#selectGeo").val(ui.item.label);     // display the selected text
                            $("#selectGeoID").val(ui.item.value);   // save selected id to hidden input
                        }
                    });          
                }
            }            
        })
    });

    // **************************** //
    //      Fonctions simples
    // **************************** //


    // **************************** //
    //      POST
    // **************************** //
    // clic connexion
    $("body").on("click", "#add", function() {
        $.ajax({
            type: 'POST',
            url: "{{ path('LoginCheck') }}",
            data: $("#formLogin").serialize(),
            dataType: 'json',
            {% include 'PolitizrFrontBundle:Navigation:ajaxError.js.twig' %}
            success: function(data) {
                if (data['error']) {
                    $('#ajaxLoader').hide();
                    $('#boxErrorLogin').html(data['error']);
                    $('#boxErrorLogin').show();
                } else {
                    // redirection
                    window.location = data['redirectUrl'];
                }
            }
        });
    });

</script>
