<script>
    // Souscription email
    $("body").on("click", "[action='notifEmailSubscribe']", function(e) {
        console.log('*** click notifEmailSubscribe');
        
        var localLoader = $(this).closest('.notificationsPrefsItem').find('.ajaxLoader').first();
        var xhrPath = "{% include 'PolitizrFrontBundle:Navigation\\Xhr:_xhrPath.html.twig' with {
            'xhrRoute': 'ROUTE_NOTIF_EMAIL_SUBSCRIBE',
            'xhrService': 'notification',
            'xhrMethod': 'notifEmailSubscribe',
            'xhrType': 'RETURN_BOOLEAN',
            } only %}";

        var subjectId = $(this).attr('subjectId');
        console.log(subjectId);

        $.ajax({
            type: 'POST',
            url: xhrPath,
            context: this,
            data: { 'subjectId': subjectId },
            dataType: 'json',
            {% include 'PolitizrFrontBundle:JS:_ajaxErrorLocalLoader.js.twig' %}
            success: function(data) {
                localLoader.hide();
                if (data['error']) {
                    $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                    $('#infoBoxHolder .boxError').show();
                } else {
                    $(this).attr('checked', 'checked');
                    $(this).attr('action', 'notifEmailUnsubscribe');
                }
            }
        });
    });

    // DÃ©souscription email
    $("body").on("click", "[action='notifEmailUnsubscribe']", function(e) {
        console.log('*** click notifEmailUnsubscribe');
        
        var localLoader = $(this).closest('.notificationsPrefsItem').find('.ajaxLoader').first();
        var xhrPath = "{% include 'PolitizrFrontBundle:Navigation\\Xhr:_xhrPath.html.twig' with {
            'xhrRoute': 'ROUTE_NOTIF_EMAIL_UNSUBSCRIBE',
            'xhrService': 'notification',
            'xhrMethod': 'notifEmailUnsubscribe',
            'xhrType': 'RETURN_BOOLEAN',
            } only %}";
                
        var subjectId = $(this).attr('subjectId');
        console.log(subjectId);

        $.ajax({
            type: 'POST',
            url: xhrPath,
            context: this,
            data: { 'subjectId': subjectId },
            dataType: 'json',
            {% include 'PolitizrFrontBundle:JS:_ajaxErrorLocalLoader.js.twig' %}
            success: function(data) {
                localLoader.hide();
                if (data['error']) {
                    $('#infoBoxHolder .boxError .notifBoxText').html(data['error']);
                    $('#infoBoxHolder .boxError').show();
                } else {
                    $(this).removeAttr('checked');
                    $(this).attr('action', 'notifEmailSubscribe');
                }
            }
        });
    });


</script>
