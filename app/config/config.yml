imports:
    - { resource: parameters.yml }
    - { resource: security.yml }
    - { resource: services.yml }
    - { resource: @GlorpenPropelBundle/Resources/config/config.yml }

parameters:
    session.attribute_bag.class: Symfony\Component\HttpFoundation\Session\Attribute\NamespacedAttributeBag

framework:
    # config / bazingageocoder
    trusted_proxies: ['127.0.0.1']

    #esi:             ~
    translator:      { fallback: %locale% }
    secret:          %secret%
    router:
        resource: "%kernel.root_dir%/config/routing.yml"
        strict_requirements: %kernel.debug%
    form:            true
    csrf_protection: true
    validation:      { enabled: true }
    templating:      { engines: ['twig'] } #assets_version: SomeVersionScheme

    default_locale:  %locale%
    # trust_proxy_headers: false # Should Request object should trust proxy headers (X_FORWARDED_FOR/HTTP_CLIENT_IP)
    session:         true

# Twig Configuration
twig:
    debug:            %kernel.debug%
    strict_variables: %kernel.debug%

    # App variables
#    globals:
#      image_path_project:     %image_path_project%
#      image_path_diaporama:   %image_path_diaporama%
    globals:
        facebook:
            client_id:          %facebook_client_id%
            client_secret:      %facebook_client_secret%
            scope:              %facebook_scope%
        pagerfanta_opts:
            previous_message:   '< page précédente'
            next_message:       'page suivante >'
            dots_message:       '...'

# Assetic Configuration
assetic:
    filters:
        uglifyjs2:
            bin:            /usr/bin/uglifyjs
        uglifycss:
            bin:            /usr/bin/uglifycss
        cssrewrite:         ~
#         sass:
#             bin:            /usr/local/bin/sass
#             apply_to:       "\.scss$"
#         less:
#             node:           /usr/bin/nodejs
#             node_paths:     [/usr/local/lib/node_modules]
#             apply_to:       "\.less$"

# Swiftmailer Configuration
swiftmailer:
    transport: "%mailer_transport%"
    auth_mode: "%mailer_auth_mode%"
    host:      "%mailer_host%"
    port:      "%mailer_port%"
    username:  "%mailer_user%"
    password:  "%mailer_password%"
    encryption: "%mailer_encryption%"

    spool:     { type: memory }

# Security Configuration
security:
    acl: ~

# JMS Security Configuration
jms_security_extra:
#    secure_controllers:  true
#    secure_all_services: false
    expressions: true

# Propel Configuration
propel:
    dbal:
        default_connection:         default
        connections:
            default:
                driver:             %database_driver%
                user:               %database_user%
                password:           %database_password%
                dsn:                %database_driver%:host=%database_host%;dbname=%database_name%
                options:
                    ATTR_PERSISTENT: false
                attributes:
                    ATTR_EMULATE_PREPARES: true
                settings:
                    charset:        { value: UTF8 }
                    queries:        { query: 'set names utf8' }

# FOSUser Configuration
fos_user:
#    service:
#        mailer:         fos_user.mailer.noop
    user_class:         FOS\UserBundle\Propel\User
    db_driver:          propel
    firewall_name:      main
    from_email:
        address:        ne-pas-repondre@politizr.fr
        sender_name:    Administrateur Politizr

# KNPMenu Configuration
knp_menu:
    twig:               # use "twig: false" to disable the Twig extension and the TwigRenderer
        template:       knp_menu.html.twig
    templating:         false # if true, enables the helper for PHP templates
    default_renderer:   twig # The renderer to use, list is also available by default

# Admin Generator
# https://github.com/symfony2admingenerator/GeneratorBundle/blob/master/Resources/doc/installation/configuration.md
admingenerator_generator:
    ## Global
    use_doctrine_orm: false
    use_doctrine_odm: false
    use_propel: true
    overwrite_if_exists: false
    base_admin_template: PolitizrAdminBundle::base_admin.html.twig
    dashboard_route: PolitizrAdminHomepage
    login_route: fos_user_security_login
    logout_route: fos_user_security_logout
    exit_route: ~
    generator_cache: ~

    ## Twig and Templates
    twig:
        use_form_resources: true
        use_localized_date: false
        date_format: Y-m-d
        datetime_format: Y-m-d H:i:s
        localized_date_format: medium
        localized_datetime_format: medium
        number_format:
            decimal: 0
            decimal_point: ,
            thousand_separator: .
    templates_dirs: []
    stylesheets: [] # array of {path: path_to_stylesheet, media: all}
    javascripts: [] # array of {path: path_to_javascript, route: route_name, routeparams: [value1, value2]}
    form_types:
        doctrine_orm:
            datetime:     datetime 
            vardatetime:  datetime 
            datetimetz:   datetime 
            date:         datetime 
            time:         time 
            decimal:      number 
            float:        number 
            integer:      integer 
            bigint:       integer 
            smallint:     integer 
            string:       text 
            text:         textarea
            entity:       entity 
            collection:   collection 
            array:        collection 
            boolean:      checkbox 
        doctrine_odm:
            datetime:     datetime 
            timestamp:    datetime 
            vardatetime:  datetime 
            datetimetz:   datetime 
            date:         datetime 
            time:         time 
            decimal:      number 
            float:        number 
            int:          integer 
            integer:      integer 
            int_id:       integer 
            bigint:       integer 
            smallint:     integer 
            id:           text 
            custom_id:    text 
            string:       text 
            text:         textarea 
            document:     document 
            collection:   collection 
            hash:         collection 
            boolean:      checkbox 
        propel:
            TIMESTAMP:    datetime 
            BU_TIMESTAMP: datetime 
            DATE:         date 
            BU_DATE:      date 
            TIME:         time 
            FLOAT:        number 
            REAL:         number 
            DOUBLE:       number 
            DECIMAL:      number 
            TINYINT:      integer 
            SMALLINT:     integer 
            INTEGER:      integer 
            BIGINT:       integer 
            NUMERIC:      integer 
            CHAR:         text 
            VARCHAR:      text 
            LONGVARCHAR:  textarea 
            BLOB:         textarea 
            CLOB:         textarea 
            CLOB_EMU:     textarea 
            model:        model 
            collection:   collection 
            PHP_ARRAY:    collection 
            ENUM:         choice 
            BOOLEAN:      checkbox 
            BOOLEAN_EMU:  checkbox 
    filter_types:
        doctrine_orm:
            datetime:      datetime
            vardatetime:   datetime
            datetimetz:    datetime
            date:          date
            time:          time
            decimal:       number
            float:         number
            integer:       number
            bigint:        number
            smallint:      number
            string:        text
            entity:        model
            collection:    collection
            array:         text
            boolean:       choice
        doctrine_odm:
            datetime:      datetime
            timestamp:     datetime
            vardatetime:   datetime
            datetimetz:    datetime
            date:          date
            time:          time
            decimal:       number
            float:         number
            int:           number
            integer:       number
            int_id:        number
            bigint:        number
            smallint:      number
            id:            text
            custom_id:     text
            string:        text
            text:          text
            document:      model
            collection:    collection
            hash:          text
            boolean:       choice
        propel:
            TIMESTAMP:     datetime
            BU_TIMESTAMP:  datetime
            DATE:          date
            BU_DATE:       date
            TIME:          time
            FLOAT:         number
            REAL:          number
            DOUBLE:        number
            DECIMAL:       number
            TINYINT:       number
            SMALLINT:      number
            INTEGER:       number
            BIGINT:        number
            NUMERIC:       number
            CHAR:          text
            VARCHAR:       text
            LONGVARCHAR:   text
            BLOB:          text
            CLOB:          text
            CLOB_EMU:      text
            model:         model
            collection:    collection
            PHP_ARRAY:     text
            ENUM:          text
            BOOLEAN:       choice
            BOOLEAN_EMU:   choice

# Liip Imagine Configuration
liip_imagine:
    resolvers:
        default:
            web_path:
              web_root:     %kernel.root_dir%/../web
              cache_prefix: /uploads/cache

#    loaders:
#        default:
#            filesystem:
#                data_root: ~  # %kernel.root_dir%/../web/
#
#    driver:               gd
#    cache:                default
#    data_loader:          default
#    default_image:        null
#    controller:
#        filter_action:         liip_imagine.controller:filterAction
#        filter_runtime_action: liip_imagine.controller:filterRuntimeAction

    filter_sets:
        # ADMIN
        admin_list_thumb:
            quality:              100
            filters:
                relative_resize:  { widen: 100 }
        admin_show_thumb:
            quality:              100
            filters:
                relative_resize:  { widen: 150 }
        admin_organization:
            quality:              100
            filters:
                relative_resize:  { widen: 50 }


        # FRONT / GENERAL
        facebook_share:
            quality:              100
            filters:
                thumbnail:         { size: [400, 400], mode: inbound }

        debate_header:
            quality:              100
            filters:
                relative_resize:  { widen: 700 }

        debate_list:
            quality:              100
            filters:
                relative_resize:  { widen: 700 }

        debate_timeline:
            quality:              100
            filters:
                relative_resize:  { widen: 600 }

        debate_abuse:
            quality:              100
            filters:
                relative_resize:  { widen: 200 }

        user_bio_back:
            quality:              100
            filters:
                relative_resize:  { widen: 700 }

        user_bio:
            quality:              100
            filters:
                relative_resize:  { widen: 60 }

        user_15:
            quality:              100
            filters:
                relative_resize:  { widen: 15 }

        user_40:
            quality:              100
            filters:
                relative_resize:  { widen: 40 }

        user_60:
            quality:              100
            filters:
                relative_resize:  { widen: 60 }

        user_follower:
            quality:              100
            filters:
                relative_resize:  { widen: 40 }

        organization_mini:
            quality:              100
            filters:
                relative_resize:  { widen: 30 }

        organization_detail:
            quality:              100
            filters:
                relative_resize:  { heighten: 80 }



        # FRONT / ESPACE CITOYEN
        c_document_list_thumb:
            quality:              100
            filters:
                relative_resize:  { widen: 100 }


# Bazinga Faker
bazinga_faker:
    locale:                             fr_FR
    entities:
        #################################################################################################################
        #                                   UTILISATEUR
        #################################################################################################################
        Politizr\Model\PUser:
            number:                     50
            custom_formatters:
                PUStatusId:             { method: numberBetween, parameters: [ 1, 1 ] }

                Copyright:              { method: lorem, parameters: [ 1, 1 ] }

                Firstname:              { method: firstname }
                Name:                   { method: lastname }

                Subtitle:               { method: realText, parameters: [ 75 ] }
                Biography:              { method: lorem, parameters: [ 50, 10, 5, 2, 2, 0, 0, 0, 0 ] }

                Website:                { method: url }
                Twitter:                { method: lexify, parameters: [ 'https://twitter.com/??????' ] }
                Facebook:               { method: lexify, parameters: [ 'https://facebook.com/??????' ] }
                Phone:                  { method: phoneNumber }

                Email:                  { method: email }

                Provider:               { method: null }
                ProviderId:             { method: null }
                Nickname:               { method: null }
                Realname:               { method: null }

                UsernameCanonical:      { method: null }
                EmailCanonical:         { method: null }
                Salt:                   { method: null }
                Password:               { method: null }
                ConfirmationToken:      { method: null }
                PasswordRequestedAt:    { method: null }

                NbViews:                { method: numberBetween, parameters: [ 150, 1500 ] }
                Qualified:              { method: boolean, parameters: [ 0 ] }
                Validated:              { method: boolean, parameters: [ 0 ] }

                Online:                 { method: boolean, parameters: [ 100 ] }
                Slug:                   { method: null }

        Politizr\Model\PUFollowT:
            number:                     150
            custom_formatters:
                PUserId:                { method: numberBetween, parameters: [ 1, 70 ] }
                PTagId:                 { method: numberBetween, parameters: [ 1, 35 ] }

        Politizr\Model\PUTaggedT:
            number:                     150
            custom_formatters:
                PUserId:                { method: numberBetween, parameters: [ 1, 70 ] }
                PTagId:                 { method: numberBetween, parameters: [ 1, 35 ] }

        Politizr\Model\PUAffinityQO:
            number:                     150
            custom_formatters:
                PUserId:                { method: numberBetween, parameters: [ 23, 70 ] }
                PQOrganizationId:       { method: numberBetween, parameters: [ 1, 13 ] }


        #################################################################################################################
        #                                   REPUTATION
        #################################################################################################################
        Politizr\Model\PUBadge:
            number:                     50
            custom_formatters:
                PUserId:                { method: numberBetween, parameters: [ 1, 70 ] }
                PRBadgeId:              { method: numberBetween, parameters: [ 1, 12 ] }

        Politizr\Model\PUReputation:
            number:                     150
            custom_formatters:
                PUserId:                { method: numberBetween, parameters: [ 1, 70 ] }
                PRActionId:             { method: numberBetween, parameters: [ 1, 12 ] }


        #################################################################################################################
        #                                   COMMANDE
        #################################################################################################################
        Politizr\Model\POrder:
            number:                     20
            custom_formatters:
                POOrderStateId:         { method: numberBetween, parameters: [ 1, 3 ] }
                POPaymentStateId:       { method: numberBetween, parameters: [ 1, 3 ] }
                POPaymentTypeId:        { method: numberBetween, parameters: [ 1, 4 ] }
                POSubscriptionId:       { method: numberBetween, parameters: [ 1, 1 ] }

                SubscriptionTitle:      { method: randomElement, parameters: [ [ 'Abonnement Annuel'] ] }
                SubscriptionDescription:  { method: randomElement, parameters: [ [ 'Abonnement Annuel'] ] }
                SubscriptionBeginAt:    { method: dateTimeThisYear }
                SubscriptionEndAt:      { method: dateTimeThisYear }

                Information:            { method: paragraphs, parameters: [ 2, true ] }

                Price:                  { method: randomFloat, parameters: [ 2, 0, 500 ] }
                Promotion:              { method: randomFloat, parameters: [ 2, 0, 500 ] }
                Total:                  { method: randomFloat, parameters: [ 2, 0, 500 ] }

                Firstname:              { method: firstname }
                Name:                   { method: lastname }

                InvoiceRef:             { method: bothify, parameters: [ '?####?#####' ], unique: true }
                InvoiceFilename:        { method: lexify, parameters: [ '?????????????.pdf' ], unique: true }

                SupportingDocument:     { method: null }
                ElectiveMandates:       { method: null }

        #################################################################################################################
        #                                   DOCUMENTS
        #################################################################################################################
        Politizr\Model\PDDebate:
            number:                     50
            custom_formatters:
                Title:                  { method: realText, parameters: [ 75 ] }

                Copyright:              { method: lorem, parameters: [ 1, 1 ] }

                Description:            { method: lorem, parameters: [ 50, 10, 5, 2, 2, 0, 0, 0, 0 ] }

                NotePos:                { method: numberBetween, parameters: [ 2, 50 ] }
                NoteNeg:                { method: numberBetween, parameters: [ 2, 50 ] }

                Favorite:               { method: boolean, parameters: [ 10 ] }

                Published:              { method: boolean, parameters: [ 90 ] }
                PublishedAt:            { method: dateTimeThisYear }
                PublishedBy:            { method: null }

                Online:                 { method: boolean, parameters: [ 100 ] }
                Slug:                   { method: null }

        Politizr\Model\PUFollowDD:
            number:                     50
            custom_formatters:
                PDDebateId:             { method: numberBetween, parameters: [ 1, 6 ] }
                PUserId:                { method: numberBetween, parameters: [ 1, 70 ] }

        Politizr\Model\PDDTaggedT:
            number:                     20
            custom_formatters:
                PDDebateId:             { method: numberBetween, parameters: [ 1, 6 ] }
                PTagId:                 { method: numberBetween, parameters: [ 1, 35 ] }

        Politizr\Model\PDDComment:
            number:                     50
            custom_formatters:
                PDDebateId:             { method: numberBetween, parameters: [ 1, 6 ] }
                PUserId:                { method: numberBetween, parameters: [ 1, 70 ] }

                Description:            { method: realText, parameters: [ 250 ] }
                ParagraphNo:            { method: randomDigit }

                NotePos:                { method: numberBetween, parameters: [ 2, 50 ] }
                NoteNeg:                { method: numberBetween, parameters: [ 2, 50 ] }

                PublishedBy:            { method: null }
                PublishedAt:            { method: dateTimeThisYear }

                Online:                 { method: boolean, parameters: [ 100 ] }

        Politizr\Model\PDRComment:
            number:                     50
            custom_formatters:
                PDReactionId:           { method: numberBetween, parameters: [ 1, 9 ] }
                PUserId:                { method: numberBetween, parameters: [ 1, 70 ] }

                Description:            { method: realText, parameters: [ 250 ] }
                ParagraphNo:            { method: randomDigit }

                NotePos:                { method: numberBetween, parameters: [ 2, 50 ] }
                NoteNeg:                { method: numberBetween, parameters: [ 2, 50 ] }

                PublishedBy:            { method: null }
                PublishedAt:            { method: dateTimeThisYear }

                Online:                 { method: boolean, parameters: [ 100 ] }


# Géoloc
bazinga_geocoder:
    fake_ip:
        enabled:                        false
        ip:                             ~
    providers:
        geoip:                          []
        free_geo_ip:                    []
        google_maps:
            locale:                     ~
            region:                     FR
            use_ssl:                    false

# OAuth Instagram
hwi_oauth:
    firewall_name:                      oauth
    resource_owners:
        facebook:       
            type:                       facebook
            client_id:                  %facebook_client_id%
            client_secret:              %facebook_client_secret%
            scope:                      %facebook_scope%
            infos_url:                  "https://graph.facebook.com/me?fields=id,name,email,birthday,picture.type(square)"
            paths:
                email:                  email
                birthday:               birthday
                profilepicture:         picture.data.url
            options:        
                display:                popup               #dialog is optimized for popup window

        twitter:
            type:                       twitter
            client_id:                  %twitter_api_key%
            client_secret:              %twitter_api_secret%

        google:
            type:                       google
            client_id:                  %google_client_id%
            client_secret:              %google_client_secret%
            scope:                      "%google_scope%"
            options:
                # access_type:       online
                approval_prompt: force

# FOSElastica
fos_elastica:
    clients:
        # Sécurisation? https://github.com/FriendsOfSymfony/FOSElasticaBundle/blob/master/Resources/doc/cookbook/elastica-client-http-headers.md#setting-http-headers-on-the-elastica-client
        default: 
            host: localhost
            port: 9200
    indexes:
        politizr:
            index_name: politizr_%kernel.environment%
            finder:                     ~
            # http://obtao.com/blog/2013/10/configuration-elasticsearch-de-maniere-optimale/
            settings:
                index:
                    analysis:
                        tokenizer:
                            nGram:
                                type:           nGram
                                min_gram:       2
                                max_gram:       20
                        analyzer:
                            custom_analyzer:
                                type:           custom
                                tokenizer:      nGram
                                filter:         [stopwords, asciifolding, lowercase, snowball, elision, worddelimiter]
                            custom_search_analyzer:
                                type:           custom
                                tokenizer:      standard
                                filter:         [stopwords, asciifolding, lowercase, snowball, elision, worddelimiter]
                        filter:
                            snowball:
                                type:           snowball
                                language:       French
                            elision:
                                type:           elision
                                articles:       [l, m, t, qu, n, s, j, d]
                            stopwords:
                                type:           stop
                                stopwords:      [_french_]
                                ignore_case:    true
                            worddelimiter:
                                type:           word_delimiter
            types:
                p_d_debate:
                    # https://github.com/FriendsOfSymfony/FOSElasticaBundle/blob/master/Resources/doc/types.md#testing-if-an-object-should-be-indexed
                    indexable_callback:         'isIndexable'
                    mappings:
                        tags:
                            property_path:      arrayTags
                            boost:              6
                            index_analyzer:     custom_analyzer
                            search_analyzer:    custom_search_analyzer
                        title:
                            boost:              3
                            index_analyzer:     custom_analyzer
                            search_analyzer:    custom_search_analyzer
                        description:
                            boost:              1
                            index_analyzer:     custom_analyzer
                            search_analyzer:    custom_search_analyzer
                    persistence:
                        # the driver can be orm, mongodb or propel
                        # listener and finder are not supported by
                        # propel and should be removed
                        driver:         propel
                        model:          Politizr\Model\PDDebate
                        provider:       ~
                        # listener:
                        #     immediate: ~
                        # ok avec propel:
                        finder:         ~
                        # https://github.com/FriendsOfSymfony/FOSElasticaBundle/blob/master/Resources/doc/types.md#handling-missing-results-with-foselasticabundle
                        elastica_to_model_transformer:
                            ignore_missing: true
                p_d_reaction:
                    indexable_callback:         'isIndexable'
                    mappings:
                        title:
                            boost:              3
                            index_analyzer:     custom_analyzer
                            search_analyzer:    custom_search_analyzer
                        description:
                            boost:              1
                            index_analyzer:     custom_analyzer
                            search_analyzer:    custom_search_analyzer
                    persistence:
                        driver:         propel
                        model:          Politizr\Model\PDReaction
                        provider:       ~
                        finder:         ~
                        elastica_to_model_transformer:
                            ignore_missing: true
                p_user:
                    indexable_callback:         'isIndexable'
                    mappings:
                        tags:
                            property_path:      arrayTags
                            boost:              6
                            index_analyzer:     custom_analyzer
                            search_analyzer:    custom_search_analyzer
                        fullName:
                            boost:              3
                            index_analyzer:     custom_analyzer
                            search_analyzer:    custom_search_analyzer
                        subtitle:
                            boost:              2
                            index_analyzer:     custom_analyzer
                            search_analyzer:    custom_search_analyzer
                        biography:
                            boost:              1
                            index_analyzer:     custom_analyzer
                            search_analyzer:    custom_search_analyzer
                    persistence:
                        driver:         propel
                        model:          Politizr\Model\PUser
                        provider:       ~
                        finder:         ~
                        elastica_to_model_transformer:
                            ignore_missing: true
